<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smooth Scroll Frames with GSAP</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&family=Nata+Sans:wght@100..900&display=swap" rel="stylesheet">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 400dvh; /* enough scroll space */
      background: #000;
      overflow-x: hidden; /* prevent sideways scroll */
      -webkit-overflow-scrolling: touch;
    }

    /* Loader Styles */
    #loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100dvh;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      color: #fff;
      font-size: clamp(1rem, 4vw, 1.5rem);
      z-index: 2000;
      transition: opacity 0.8s ease, visibility 0.8s ease;
    }

    #progress-text {
      margin-top: 10px;
      font-size: clamp(0.9rem, 3vw, 1.2rem);
    }

    /* Black Overlay (fades away on scroll) */
    #blackOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100dvh;
      background: #000;
      z-index: 1400;
      pointer-events: none;
    }

    /* Intro Text */
    #introText {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-family: "Nata Sans", sans-serif;
      font-weight: 600;
      font-size: 3vw;
      color: #fff;
      z-index: 1500;
      opacity: 0;
      transition: opacity 1s ease;
      pointer-events: none;
      text-align: center;
      padding: 0 10px; /* prevent text cutoff on small screens */
    }

    /* Frame Container */
    #frameContainer {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100vw;
      height: 100dvh;
      overflow: hidden;
      display: none; /* hidden until loaded */
      z-index: 100;
    }

    #frameContainer img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
    }

    /* Play Button */
    #playAudioBtn {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 1600;
      background: transparent;
      border: none;
      color: #fff;
      font-size: clamp(0.9rem, 3vw, 1rem);
      outline: 2px solid #fff;
      cursor: pointer;
      padding: 6px 12px;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <!-- Loader -->
  <div id="loader">
    <div>Loading...</div>
    <div id="progress-text">0%</div>
  </div>

  <!-- Black Overlay + Intro Text -->
  <div id="blackOverlay"></div>
  <div id="introText">Experience tranquility.</div>

  <!-- Background Audio -->
  <audio id="bgAudio" src="audio/background.m4a" loop hidden></audio>
  <button id="playAudioBtn">Play Audio</button>

  <!-- Scroll-triggered Audio -->
  <audio id="scrollAudio" src="audio/scroll.mp3" hidden></audio>

  <!-- Frame Container -->
  <div id="frameContainer">
    <img id="scrollFrame" src="frames/ezgif-frame-001.png" alt="Frame">
  </div> 

  <!-- GSAP + ScrollTrigger -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
  
  <script>
    // --- CONFIG ---
    const totalFrames = 150; 
    const frameElement = document.getElementById("scrollFrame");
    const bgAudio = document.getElementById("bgAudio");
    bgAudio.volume = 0.2; 
    const scrollAudio = document.getElementById("scrollAudio");
    scrollAudio.volume = 1.0;
    const playAudioBtn = document.getElementById("playAudioBtn");
    const loader = document.getElementById("loader");
    const progressText = document.getElementById("progress-text");
    const frameContainer = document.getElementById("frameContainer");
    const introText = document.getElementById("introText");
    const blackOverlay = document.getElementById("blackOverlay");

    let audioStarted = false;
    let loadedFrames = 0;

    // --- HELPERS ---
    function pad(num, size) {
      return String(num).padStart(size, "0");
    }

    function preloadImages() {
      for (let i = 1; i <= totalFrames; i++) {
        const img = new Image();
        img.src = `frames/ezgif-frame-${pad(i, 3)}.png`;

        img.onload = () => {
          loadedFrames++;
          let percent = Math.floor((loadedFrames / totalFrames) * 100);
          progressText.textContent = `${percent}%`;

          if (loadedFrames === totalFrames) {
            // Fade out loader
            loader.style.opacity = "0";
            loader.style.visibility = "hidden";
            frameContainer.style.display = "block";

            // Show intro text after loader
            setTimeout(() => {
              introText.style.opacity = "1";
            }, 500);

            // Animate overlay fade on scroll
            gsap.to(blackOverlay, {
              opacity: 0,
              scrollTrigger: {
                trigger: "body",
                start: "top top",
                end: "20% top",
                scrub: true
              }
            });

            // Fade out intro text with scroll
            gsap.to(introText, {
              opacity: 0,
              scrollTrigger: {
                trigger: "body",
                start: "top top",
                end: "20% top",
                scrub: true
              }
            });
          }
        };
      }
    }
    preloadImages();

    // --- BACKGROUND AUDIO CONTROL ---
    playAudioBtn.addEventListener("click", () => {
      bgAudio.play();
      playAudioBtn.style.display = "none";
      audioStarted = true;
    });

    window.addEventListener("scroll", function onFirstScroll() {
      if (!audioStarted) {
        bgAudio.play().catch(() => {});
        playAudioBtn.style.display = "none";
        audioStarted = true;
      }
      window.removeEventListener("scroll", onFirstScroll);
    });

    // --- SCROLL FRAMES + AUDIO ---
    gsap.registerPlugin(ScrollTrigger);

    let frame = { i: 1 };

    gsap.to(frame, {
      i: totalFrames,
      ease: "none",
      scrollTrigger: {
        scrub: true,
        start: "top top",
        end: "bottom bottom",
        onUpdate: (self) => {
          // Update frame
          let frameNum = pad(Math.round(frame.i), 3);
          frameElement.src = `frames/ezgif-frame-${frameNum}.png`;

          // Play scroll audio (trigger once per scroll activity)
          if (self.isActive && scrollAudio.paused) {
            scrollAudio.currentTime = 0;
            scrollAudio.play().catch(() => {});
          }
        }
      }
    });
  </script>
</body>
</html>
